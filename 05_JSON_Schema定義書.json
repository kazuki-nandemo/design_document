{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ユーザー管理システム API Schema定義",
  "version": "1.0.0",
  "definitions": {
    "User": {
      "type": "object",
      "description": "ユーザーオブジェクト",
      "properties": {
        "id": {
          "type": "string",
          "description": "ユーザーID（プレフィックス: usr_）",
          "pattern": "^usr_[a-zA-Z0-9]{10,}$",
          "example": "usr_1234567890"
        },
        "firstName": {
          "type": "string",
          "description": "名",
          "minLength": 1,
          "maxLength": 50,
          "example": "太郎"
        },
        "lastName": {
          "type": "string",
          "description": "姓",
          "minLength": 1,
          "maxLength": 50,
          "example": "山田"
        },
        "email": {
          "type": "string",
          "description": "メールアドレス",
          "format": "email",
          "minLength": 3,
          "maxLength": 254,
          "example": "taro.yamada@example.com"
        },
        "birthDate": {
          "type": "string",
          "description": "生年月日",
          "format": "date",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$",
          "example": "1990-01-01"
        },
        "gender": {
          "type": "string",
          "description": "性別",
          "enum": ["male", "female", "other", "prefer_not_to_say"],
          "example": "male"
        },
        "status": {
          "type": "string",
          "description": "アカウントステータス",
          "enum": ["active", "inactive"],
          "default": "active",
          "example": "active"
        },
        "profileImage": {
          "type": "string",
          "description": "プロフィール画像URL",
          "format": "uri",
          "example": "https://storage.example.com/users/usr_1234567890/profile.jpg"
        },
        "createdAt": {
          "type": "string",
          "description": "作成日時",
          "format": "date-time",
          "example": "2025-11-15T10:30:00Z"
        },
        "updatedAt": {
          "type": "string",
          "description": "更新日時",
          "format": "date-time",
          "example": "2025-11-15T10:30:00Z"
        },
        "lastLoginAt": {
          "type": "string",
          "description": "最終ログイン日時",
          "format": "date-time",
          "example": "2025-11-15T14:00:00Z"
        },
        "deletedAt": {
          "type": ["string", "null"],
          "description": "削除日時（論理削除）",
          "format": "date-time",
          "example": null
        }
      },
      "required": ["id", "firstName", "lastName", "email", "birthDate", "status", "createdAt", "updatedAt"]
    },
    "Pagination": {
      "type": "object",
      "description": "ページネーション情報",
      "properties": {
        "currentPage": {
          "type": "integer",
          "description": "現在のページ番号",
          "minimum": 1,
          "example": 1
        },
        "totalPages": {
          "type": "integer",
          "description": "総ページ数",
          "minimum": 0,
          "example": 5
        },
        "totalCount": {
          "type": "integer",
          "description": "総件数",
          "minimum": 0,
          "example": 100
        },
        "limit": {
          "type": "integer",
          "description": "1ページあたりの件数",
          "minimum": 1,
          "maximum": 100,
          "example": 20
        },
        "hasNext": {
          "type": "boolean",
          "description": "次ページの有無",
          "example": true
        },
        "hasPrevious": {
          "type": "boolean",
          "description": "前ページの有無",
          "example": false
        }
      },
      "required": ["currentPage", "totalPages", "totalCount", "limit", "hasNext", "hasPrevious"]
    },
    "Error": {
      "type": "object",
      "description": "エラー情報",
      "properties": {
        "code": {
          "type": "string",
          "description": "エラーコード",
          "example": "VALIDATION_ERROR"
        },
        "message": {
          "type": "string",
          "description": "エラーメッセージ",
          "example": "入力内容に誤りがあります"
        },
        "details": {
          "type": "array",
          "description": "エラー詳細",
          "items": {
            "type": "object",
            "properties": {
              "field": {
                "type": "string",
                "description": "エラーフィールド名",
                "example": "email"
              },
              "message": {
                "type": "string",
                "description": "フィールドごとのエラーメッセージ",
                "example": "このメールアドレスは既に登録されています"
              }
            },
            "required": ["field", "message"]
          }
        },
        "requestId": {
          "type": "string",
          "description": "リクエストID（トレーシング用）",
          "example": "req_xyz789"
        }
      },
      "required": ["code", "message"]
    }
  },
  "schemas": {
    "CreateUserRequest": {
      "$id": "/schemas/CreateUserRequest",
      "type": "object",
      "description": "ユーザー作成リクエスト",
      "properties": {
        "firstName": {
          "type": "string",
          "minLength": 1,
          "maxLength": 50,
          "example": "太郎"
        },
        "lastName": {
          "type": "string",
          "minLength": 1,
          "maxLength": 50,
          "example": "山田"
        },
        "email": {
          "type": "string",
          "format": "email",
          "minLength": 3,
          "maxLength": 254,
          "example": "taro.yamada@example.com"
        },
        "password": {
          "type": "string",
          "description": "パスワード（8文字以上、英大文字・小文字・数字・記号を含む）",
          "minLength": 8,
          "maxLength": 128,
          "pattern": "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,128}$",
          "example": "SecurePass123!"
        },
        "birthDate": {
          "type": "string",
          "format": "date",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$",
          "example": "1990-01-01"
        },
        "gender": {
          "type": "string",
          "enum": ["male", "female", "other", "prefer_not_to_say"],
          "example": "male"
        }
      },
      "required": ["firstName", "lastName", "email", "password", "birthDate"],
      "additionalProperties": false
    },
    "CreateUserResponse": {
      "$id": "/schemas/CreateUserResponse",
      "type": "object",
      "description": "ユーザー作成レスポンス",
      "properties": {
        "success": {
          "type": "boolean",
          "const": true,
          "example": true
        },
        "data": {
          "$ref": "#/definitions/User"
        },
        "message": {
          "type": "string",
          "example": "ユーザーが正常に作成されました"
        }
      },
      "required": ["success", "data", "message"]
    },
    "GetUsersRequest": {
      "$id": "/schemas/GetUsersRequest",
      "type": "object",
      "description": "ユーザー一覧取得リクエスト（クエリパラメータ）",
      "properties": {
        "page": {
          "type": "integer",
          "description": "ページ番号",
          "minimum": 1,
          "default": 1,
          "example": 1
        },
        "limit": {
          "type": "integer",
          "description": "1ページあたりの件数",
          "minimum": 1,
          "maximum": 100,
          "default": 20,
          "example": 20
        },
        "search": {
          "type": "string",
          "description": "検索キーワード（名前・メールアドレス）",
          "maxLength": 100,
          "example": "山田"
        },
        "status": {
          "type": "string",
          "description": "ステータスフィルタ",
          "enum": ["active", "inactive"],
          "example": "active"
        },
        "sortBy": {
          "type": "string",
          "description": "ソート項目",
          "enum": ["createdAt", "lastName", "email"],
          "default": "createdAt",
          "example": "createdAt"
        },
        "order": {
          "type": "string",
          "description": "ソート順",
          "enum": ["asc", "desc"],
          "default": "desc",
          "example": "desc"
        }
      },
      "additionalProperties": false
    },
    "GetUsersResponse": {
      "$id": "/schemas/GetUsersResponse",
      "type": "object",
      "description": "ユーザー一覧取得レスポンス",
      "properties": {
        "success": {
          "type": "boolean",
          "const": true,
          "example": true
        },
        "data": {
          "type": "object",
          "properties": {
            "users": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/User"
              }
            },
            "pagination": {
              "$ref": "#/definitions/Pagination"
            }
          },
          "required": ["users", "pagination"]
        }
      },
      "required": ["success", "data"]
    },
    "GetUserResponse": {
      "$id": "/schemas/GetUserResponse",
      "type": "object",
      "description": "ユーザー詳細取得レスポンス",
      "properties": {
        "success": {
          "type": "boolean",
          "const": true,
          "example": true
        },
        "data": {
          "$ref": "#/definitions/User"
        }
      },
      "required": ["success", "data"]
    },
    "UpdateUserRequest": {
      "$id": "/schemas/UpdateUserRequest",
      "type": "object",
      "description": "ユーザー更新リクエスト",
      "properties": {
        "firstName": {
          "type": "string",
          "minLength": 1,
          "maxLength": 50,
          "example": "太郎"
        },
        "lastName": {
          "type": "string",
          "minLength": 1,
          "maxLength": 50,
          "example": "山田"
        },
        "email": {
          "type": "string",
          "format": "email",
          "minLength": 3,
          "maxLength": 254,
          "example": "taro.yamada.new@example.com"
        },
        "birthDate": {
          "type": "string",
          "format": "date",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$",
          "example": "1990-01-01"
        },
        "gender": {
          "type": "string",
          "enum": ["male", "female", "other", "prefer_not_to_say"],
          "example": "male"
        },
        "status": {
          "type": "string",
          "description": "ステータス（管理者のみ変更可）",
          "enum": ["active", "inactive"],
          "example": "active"
        }
      },
      "required": ["firstName", "lastName", "email", "birthDate"],
      "additionalProperties": false
    },
    "UpdateUserResponse": {
      "$id": "/schemas/UpdateUserResponse",
      "type": "object",
      "description": "ユーザー更新レスポンス",
      "properties": {
        "success": {
          "type": "boolean",
          "const": true,
          "example": true
        },
        "data": {
          "$ref": "#/definitions/User"
        },
        "message": {
          "type": "string",
          "example": "ユーザー情報が正常に更新されました"
        }
      },
      "required": ["success", "data", "message"]
    },
    "DeleteUserResponse": {
      "$id": "/schemas/DeleteUserResponse",
      "type": "object",
      "description": "ユーザー削除レスポンス",
      "properties": {
        "success": {
          "type": "boolean",
          "const": true,
          "example": true
        },
        "data": {
          "type": "object",
          "properties": {
            "id": {
              "type": "string",
              "example": "usr_1234567890"
            },
            "deletedAt": {
              "type": "string",
              "format": "date-time",
              "example": "2025-11-15T17:00:00Z"
            }
          },
          "required": ["id", "deletedAt"]
        },
        "message": {
          "type": "string",
          "example": "ユーザーが正常に削除されました"
        }
      },
      "required": ["success", "data", "message"]
    },
    "ErrorResponse": {
      "$id": "/schemas/ErrorResponse",
      "type": "object",
      "description": "エラーレスポンス",
      "properties": {
        "success": {
          "type": "boolean",
          "const": false,
          "example": false
        },
        "error": {
          "$ref": "#/definitions/Error"
        }
      },
      "required": ["success", "error"]
    }
  }
}
