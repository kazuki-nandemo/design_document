# 画面遷移図

**プロジェクト**: ユーザー管理システム
**作成日**: 2025-11-15

---

## 画面遷移の全体像

```mermaid
graph TB
    Start([アプリ起動]) --> Login[ログイン画面]

    Login -->|ログイン成功| Home[ホーム画面]
    Login -->|新規登録リンク| Register[ユーザー登録画面]
    Login -->|パスワード忘れ| ResetPassword[パスワードリセット画面]

    Register -->|登録成功| Login
    Register -->|キャンセル| Login

    ResetPassword -->|送信完了| Login
    ResetPassword -->|キャンセル| Login

    Home -->|ユーザー一覧選択| UserList[ユーザー一覧画面]
    Home -->|マイページ選択| Profile[プロフィール画面]
    Home -->|ログアウト| Login

    UserList -->|新規作成ボタン| UserCreate[ユーザー新規作成画面]
    UserList -->|編集ボタン| UserEdit[ユーザー編集画面]
    UserList -->|削除ボタン| DeleteConfirm[削除確認モーダル]
    UserList -->|戻る| Home

    UserCreate -->|作成成功| UserList
    UserCreate -->|キャンセル| UserList

    UserEdit -->|更新成功| UserList
    UserEdit -->|削除ボタン| DeleteConfirm
    UserEdit -->|キャンセル| UserList

    DeleteConfirm -->|削除実行| UserList
    DeleteConfirm -->|キャンセル| UserList

    Profile -->|編集ボタン| ProfileEdit[プロフィール編集画面]
    Profile -->|パスワード変更| PasswordChange[パスワード変更画面]
    Profile -->|ログアウト| Login
    Profile -->|戻る| Home

    ProfileEdit -->|更新成功| Profile
    ProfileEdit -->|キャンセル| Profile

    PasswordChange -->|変更成功| Profile
    PasswordChange -->|キャンセル| Profile

    style Login fill:#e1f5ff
    style Home fill:#fff3e0
    style UserList fill:#f3e5f5
    style Profile fill:#e8f5e9
```

---

## 主な画面遷移

### ログイン周り
- アプリ起動 → ログイン画面
- ログイン画面 → ホーム画面（認証成功時）
- ログイン画面 → ユーザー登録画面（新規登録リンク）
- ログイン画面 → パスワードリセット画面（パスワード忘れリンク）

### ユーザー管理
- ホーム → ユーザー一覧
- ユーザー一覧 → ユーザー編集（編集ボタン）※管理者のみ
- ユーザー一覧 → 新規作成画面（新規作成ボタン）※管理者のみ
- ユーザー編集/一覧 → 削除確認モーダル（削除ボタン）※管理者のみ

### マイページ周り
- ホーム → プロフィール画面
- プロフィール → プロフィール編集
- プロフィール → パスワード変更

### キャンセル/戻る
- 各編集画面のキャンセルボタン → 元の画面に戻る
- 登録成功/更新成功 → 一覧画面へ（成功メッセージ表示）

---

## 認証状態による遷移制御

### 未認証時にアクセス可能な画面
- ログイン画面
- ユーザー登録画面
- パスワードリセット画面

### 認証済み時にアクセス可能な画面
- ホーム画面
- ユーザー一覧画面（閲覧）
- プロフィール画面
- プロフィール編集画面
- パスワード変更画面

### 管理者権限が必要な画面
- ユーザー新規作成画面
- ユーザー編集画面
- ユーザー削除機能

---

## エラー時の動作

**認証エラー（401）**
- → ログイン画面に強制遷移
- セッション破棄してエラーメッセージ表示

**権限エラー（403）**
- → 元の画面のまま
- エラートースト表示

**データ不在（404）**
- → 一覧画面へ戻る
- エラートースト表示

**サーバーエラー（500）/ネットワークエラー**
- → 元の画面のまま
- エラートースト表示
- リトライボタン表示

---

## 補足

- 全体的にモーダルはESCキーで閉じれるようにする
- ブラウザバック対応（できるだけ自然な遷移になるように）
- ログイン前に特定のページにアクセスしようとした場合、ログイン後にそのページへリダイレクト
